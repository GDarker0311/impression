!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Impression=t():e.Impression=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MUTATION="mutation",t.RESIZE="resize",t.SCROLL="scroll",t.UNLOAD="unload"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BEGIN="begin",t.END="end"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){if(e instanceof HTMLElement){"static"===window.getComputedStyle(e).position&&(e.style.position="relative")}}},function(e,t,n){"use strict";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){this._events=new r,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,u="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(u=!1)),i.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)s.call(e,t)&&n.push(u?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},i.prototype.listeners=function(e,t){var n=u?u+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},i.prototype.emit=function(e,t,n,r,o,i){var s=u?u+e:e;if(!this._events[s])return!1;var f,a,c=this._events[s],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,i),!0}for(a=1,f=new Array(l-1);a<l;a++)f[a-1]=arguments[a];c.fn.apply(c.context,f)}else{var d,v=c.length;for(a=0;a<v;a++)switch(c[a].once&&this.removeListener(e,c[a].fn,void 0,!0),l){case 1:c[a].fn.call(c[a].context);break;case 2:c[a].fn.call(c[a].context,t);break;case 3:c[a].fn.call(c[a].context,t,n);break;case 4:c[a].fn.call(c[a].context,t,n,r);break;default:if(!f)for(d=1,f=new Array(l-1);d<l;d++)f[d-1]=arguments[d];c[a].fn.apply(c[a].context,f)}}return!0},i.prototype.on=function(e,t,n){var r=new o(t,n||this),i=u?u+e:e;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],r]:this._events[i].push(r):(this._events[i]=r,this._eventsCount++),this},i.prototype.once=function(e,t,n){var r=new o(t,n||this,!0),i=u?u+e:e;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],r]:this._events[i].push(r):(this._events[i]=r,this._eventsCount++),this},i.prototype.removeListener=function(e,t,n,o){var i=u?u+e:e;if(!this._events[i])return this;if(!t)return 0==--this._eventsCount?this._events=new r:delete this._events[i],this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||(0==--this._eventsCount?this._events=new r:delete this._events[i]);else{for(var f=0,a=[],c=s.length;f<c;f++)(s[f].fn!==t||o&&!s[f].once||n&&s[f].context!==n)&&a.push(s[f]);a.length?this._events[i]=1===a.length?a[0]:a:0==--this._eventsCount?this._events=new r:delete this._events[i]}return this},i.prototype.removeAllListeners=function(e){var t;return e?(t=u?u+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new r:delete this._events[t])):(this._events=new r,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=u,i.EventEmitter=i,e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=void 0;return function(){for(var r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];clearTimeout(n),n=setTimeout(function(){e.apply(void 0,o)},t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r),i=function(e,t,n,r){var i=t.nodes;t.nodes=[];var s=document.querySelectorAll(e);Array.prototype.forEach.call(s,function(e){var s=!1;i&&i.forEach(function(t){var n=t.node;t.marked||n!==e||(s=t.isVisible,t.marked=!0)});var u={isVisible:n(e),wasVisible:s,node:e};t.nodes.push(u),!0===u.isVisible&&!1===u.wasVisible&&t.events.emit(o.BEGIN,e,{type:r}),!1===u.isVisible&&!0===u.wasVisible&&t.events.emit(o.END,e,{type:r})}),i&&i.forEach(function(e){e.marked||e.isVisible&&t.events.emit(o.END,e.node,{type:r})})};t.default=function(e,t,n){Object.keys(e).forEach(function(r){var o=e[r];i(r,o,n,t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r),i=function(e,t,n){var r=t.nodes;r&&r.forEach(function(e){e.node.isVisible&&t.events.emit(o.END,e.node,{type:n})})};t.default=function(e,t){Object.keys(e).forEach(function(t){var n=e[t];i(0,n)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Object.keys(t).some(function(n){return t[n]===e})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),i=r(o),s=n(12),u=r(s),f=n(13),a=r(f),c=n(14),l=r(c);t.default=function(e){var t=(0,i.default)(document.body),n=(0,u.default)(e),r=(0,a.default)(e),o=(0,l.default)();return{on:function(e){return t.on(e),n.on(e),r.on(e),o.on(e),!0},off:function(){return t.off(),n.off(),r.off(),o.off(),!0}}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(15),i=r(o),s=n(18),u=r(s),f=n(16),a=r(f),c=n(17),l=r(c);t.default=function(e,t,n){var r=!0,o=e;for(r=t===window?(0,l.default)(e,n):(0,a.default)(e,t,n);o.parentNode&&r;)r=(0,i.default)(o)&&(0,u.default)(o),o=o.parentNode;return r}},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),f=o(u),a=n(9),c=o(a),l=n(8),d=o(l),v=n(4),h=o(v),_=n(5),p=o(_),y=n(6),b=o(y),w=n(7),m=o(w),O=n(0),E=r(O),M=n(1),k=r(M);e.exports=t.default=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.tolerance,r=void 0===n?0:n,o=t.debounce,s=void 0===o?100:o,u=t.container,a=void 0===u?window:u;i(this,e),this._attached=!1,this._trackedElements={},this._tolerance=r,this._debounce=s,this._container=a,this._observers=(0,d.default)(this._container),this._handler=(0,h.default)(this._handlers.bind(this),this._debounce),this._events=new f.default,this.attach()}return s(e,[{key:"attach",value:function(){return this._attached||(this._attached=!0,this._observers.on(this._handler)),this}},{key:"detach",value:function(){return this._attached&&(this._observers.off(),this._attached=!1),this}},{key:"isViewable",value:function(e){return(0,c.default)(e,this._container,this._tolerance)}},{key:"on",value:function(e,t,n){if(!(0,m.default)(e,k))throw new Error("impression: event not accepted: "+e);return this._onViewableChange(e,t,n),this}},{key:"once",value:function(e,t,n){if(!(0,m.default)(e,k))throw new Error("impression: event not accepted: "+e);return this._onceViewableChange(e,t,n),this}},{key:"off",value:function(e,t,n){return this._offViewableChange(e,t,n),this}},{key:"onObservers",value:function(e,t){if(!(0,m.default)(e,E))throw new Error("impression: event not accepted: "+e);return this._events.on(e,t),this}},{key:"onceObservers",value:function(e,t){if(!(0,m.default)(e,E))throw new Error("impression: event not accepted: "+e);return this._events.once(e,t),this}},{key:"offObservers",value:function(e,t){return e?t?this._events.removeListener(e,t):this._events.removeAllListeners(e):this._events.removeAllListeners(),this}},{key:"_handlers",value:function(e){this._events.emit(e);var t=this._trackedElements;return e===E.UNLOAD?(0,b.default)(t,e):(0,p.default)(t,e,this.isViewable.bind(this)),this}},{key:"_onViewableChange",value:function(e,t,n){this._trackedElements[t]||(this._trackedElements[t]={});var r=this._trackedElements[t];return r.nodes||(r.nodes=[]),r.events||(r.events=new f.default),r.events.on(e,n),this}},{key:"_onceViewableChange",value:function(e,t,n){this._trackedElements[t]||(this._trackedElements[t]={});var r=this._trackedElements[t];return r.nodes||(r.nodes=[]),r.events||(r.events=new f.default),r.events.once(e,n),this}},{key:"_offViewableChange",value:function(e,t,n){return e?(t?this._offViewableChangeBySelector(e,t,n):this._offViewableChangeByEvent(e),this._cleanUpTracked()):this._offViewableChangeAll(),this}},{key:"_offViewableChangeBySelector",value:function(e,t,n){var r=this._trackedElements;if(n){var o=r[t];o&&o.events&&o.events.removeListener(e,n)}else{var i=r[t];i&&i.events&&i.events.removeAllListeners(e)}return this}},{key:"_offViewableChangeByEvent",value:function(e){var t=this._trackedElements;return Object.keys(t).forEach(function(n){var r=t[n];r&&r.events&&r.events.removeAllListeners(e)}),this}},{key:"_offViewableChangeAll",value:function(){var e=this._trackedElements;return Object.keys(e).forEach(function(t){delete e[t]}),this}},{key:"_cleanUpTracked",value:function(){var e=this._trackedElements;return Object.keys(e).forEach(function(t){var n=e[t];n&&n.events&&0===n.events.listeners(k.BEGIN).length&&0===n.events.listeners(k.END).length&&delete e[t]}),this}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(r),i=n(0),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i);t.default=function(e){var t=void 0,n=void 0,r=void 0;return{on:function(i){if(t)return!1;t=!0,r=function(){return i(s.MUTATION)},(0,o.default)(e);var u=window.MutationObserver||window.WebKitMutationObserver;return u?(n=new u(r),n.observe(e,{childList:!0,attributes:!0,subtree:!0})):(e.addEventListener("DOMNodeInserted",r),e.addEventListener("DOMNodeRemoved",r),e.addEventListener("DOMAttrModified",r),e.addEventListener("DOMSubtreeModified",r)),!0},off:function(){return!!t&&(n?n.disconnect():(e.removeEventListener("DOMNodeInserted",r),e.removeEventListener("DOMNodeRemoved",r),e.removeEventListener("DOMAttrModified",r),e.removeEventListener("DOMSubtreeModified",r)),t=!1,!0)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(r),i=n(0),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i);t.default=function(e){var t=!1,n=void 0;return{on:function(r){return!t&&(t=!0,n=function(){return r(s.RESIZE)},(0,o.default)(e),e.addEventListener("resize",n),!0)},off:function(){return!!t&&(e.removeEventListener("resize",n),t=!1,!0)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(r),i=n(0),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i);t.default=function(e){var t=!1,n=void 0;return{on:function(r){return!t&&(t=!0,n=function(){return r(s.SCROLL)},(0,o.default)(e),e.addEventListener("scroll",n),!0)},off:function(){return!!t&&(e.removeEventListener("scroll",n),t=!1,!0)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r);t.default=function(){var e=!1,t=void 0;return{on:function(n){return!e&&(e=!0,t=function(){return n(o.UNLOAD)},window.addEventListener("beforeunload",t),!0)},off:function(){return!!e&&(window.removeEventListener("beforeunload",t),e=!1,!0)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={hidden:!0};t.default=function(e){return!Object.keys(r).some(function(t){return e[t]===r[t]})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t.getBoundingClientRect(),o=e.offsetTop+n<r.height+t.scrollTop,i=e.offsetTop+e.clientHeight-n>t.scrollTop,s=e.offsetLeft+n<r.width+t.scrollLeft,u=e.offsetLeft+e.clientWidth-n>t.scrollLeft;return o&&i&&s&&u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth,i=e.offsetHeight,s=e.offsetWidth,u=t>i?i:t,f=t>s?s:t,a=n.top+i,c=a>=u,l=r-(n.bottom-i),d=l>=u,v=n.left+s,h=v>=f,_=o-(n.right-s),p=_>=f;return c&&d&&h&&p}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={display:"none",visibility:"hidden"};t.default=function(e){var t=window.getComputedStyle(e);return!Object.keys(r).some(function(e){return t[e]===r[e]})}}])});